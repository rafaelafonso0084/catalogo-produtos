<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Catálogo de Produtos - Fornecedora Presidente</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-4">

  <h1 class="text-3xl font-bold mb-4 text-center">Catálogo de Produtos</h1>

  <!-- Filtros -->
  <div class="flex flex-col md:flex-row justify-between gap-4 mb-4">
    <input type="text" id="search" placeholder="Buscar produto..." class="w-full md:w-1/2 px-4 py-2 rounded border border-gray-300" />
    <select id="categoryFilter" class="w-full md:w-1/4 px-4 py-2 rounded border border-gray-300">
      <option value="">Todas as categorias</option>
    </select>
  </div>

  <!-- Produtos -->
  <div id="productList" class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-20"></div>

  <!-- Carrinho -->
  <div class="fixed bottom-0 left-0 right-0 bg-white shadow p-4 border-t border-gray-300">
    <h2 class="text-xl font-bold mb-2">🛒 Carrinho</h2>
    <ul id="cartItems" class="mb-2 list-disc list-inside text-sm text-gray-700"></ul>
    <button id="sendWhatsApp" class="bg-[#25D366] hover:bg-[#1DA851] text-white font-semibold px-6 py-2 rounded transition disabled:opacity-50 disabled:cursor-not-allowed" disabled>
      Enviar Pedido via WhatsApp
    </button>
  </div>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbxHKtY2I_kHSBJRgUKBJKAj01o3lokp4_4P_aRtiPjx-zuBwOR-4RBaimB-hax0liGxqg/exec";
    const numeroWhatsApp = "5521970462260";

    let produtos = [];
    let carrinho = [];

    const productList = document.getElementById('productList');
    const searchInput = document.getElementById('search');
    const categoryFilter = document.getElementById('categoryFilter');
    const cartItems = document.getElementById('cartItems');
    const sendWhatsApp = document.getElementById('sendWhatsApp');

    async function carregarDados() {
      try {
        const resposta = await fetch(API_URL);
        produtos = await resposta.json();
        populateCategories();
        renderProducts(produtos);
      } catch (erro) {
        productList.innerHTML = `<p class="text-red-500">Erro ao carregar produtos: ${erro}</p>`;
      }
    }

    function renderProducts(data) {
      productList.innerHTML = '';
      if (data.length === 0) {
        productList.innerHTML = '<p class="text-center col-span-3">Nenhum produto encontrado.</p>';
        return;
      }

      data.forEach(produto => {
        const card = document.createElement('div');
        card.className = 'bg-white rounded-lg p-4 shadow';

        card.innerHTML = `
          <h2 class="text-lg font-semibold">${produto.Produtos}</h2>
          <p class="text-sm text-gray-600">Código: ${produto.Código}</p>
          <p class="text-sm text-gray-600 mb-2">Categoria: ${produto.Categoria}</p>
          <button class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded font-semibold shadow mt-2">
            Adicionar ao Carrinho
          </button>
        `;

        const button = card.querySelector('button');
        button.addEventListener('click', () => adicionarAoCarrinho(produto));

        productList.appendChild(card);
      });
    }

    function populateCategories() {
      const categorias = [...new Set(produtos.map(p => p.Categoria))];
      categorias.forEach(cat => {
        const opt = document.createElement('option');
        opt.value = cat;
        opt.textContent = cat;
        categoryFilter.appendChild(opt);
      });
    }

    function applyFilters() {
      const termo = searchInput.value.toLowerCase();
      const categoria = categoryFilter.value;

      const filtrado = produtos.filter(p => {
        return (
          (!categoria || p.Categoria === categoria) &&
          p.Produtos.toLowerCase().includes(termo)
        );
      });

      renderProducts(filtrado);
    }

    function adicionarAoCarrinho(produto) {
      carrinho.push(produto);
      atualizarCarrinho();
    }

    function atualizarCarrinho() {
      cartItems.innerHTML = '';
      carrinho.forEach((p, i) => {
        const li = document.createElement('li');
        li.textContent = `${p.Produtos} (Código: ${p.Código})`;
        cartItems.appendChild(li);
      });

      sendWhatsApp.disabled = carrinho.length === 0;
    }

    sendWhatsApp.addEventListener('click', () => {
      if (carrinho.length === 0) return;

      const mensagem = `Olá! Gostaria de fazer o seguinte pedido:\n\n` +
        carrinho.map((p, i) => `${i + 1}. ${p.Produtos} (Código: ${p.Código}) - Categoria: ${p.Categoria}`).join('\n') +
        `\n\nAguardo confirmação.`;

      const link = `https://wa.me/${numeroWhatsApp}?text=${encodeURIComponent(mensagem)}`;
      window.open(link, '_blank');
    });

    // Inicialização
    carregarDados();
    searchInput.addEventListener('input', applyFilters);
    categoryFilter.addEventListener('change', applyFilters);
  </script>
</body>
</html>
